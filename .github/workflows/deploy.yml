name: "Deploy Documentation"

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    inputs:
      force:
        type: boolean
        description: Force build (skip version check)
        default: false
      git_ref:
        type: string
        default: main
  repository_dispatch:
    types: [update_docs]
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
      - name: Call deploy workflow [push_on_main]
        if: (github.event_name == 'push' && github.ref == 'refs/heads/main')
        uses: platformatic/oss/.github/workflows/rebuild-and-deploy-docs.yml@main
        with:
          original_event: push_on_main
        secrets:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TARGET_REPO: ${{ secrets.TARGET_REPO }}
      - name: Call deploy workflow [repository_dispatch]
        if: (github.event_name == 'repository_dispatch' && github.event.action == 'update_docs')
        uses: platformatic/oss/.github/workflows/rebuild-and-deploy-docs.yml@main
        with:
          force: github.event.client_payload.force
          git_ref: github.event.client_payload.git_ref
          original_event: repository_dispatch
        secrets:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TARGET_REPO: ${{ secrets.TARGET_REPO }}
      - name: Call deploy workflow [workflow_dispatch]
        if: (github.event_name == 'workflow_dispatch')
        uses: platformatic/oss/.github/workflows/rebuild-and-deploy-docs.yml@main
        with:
          force: github.event.inputs.force
          git_ref: github.event.inputs.git_ref
          original_event: workflow_dispatch
        secrets:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TARGET_REPO: ${{ secrets.TARGET_REPO }}